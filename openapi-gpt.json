{
  "openapi": "3.1.0",
  "info": {
    "title": "AliExpress Affiliate API",
    "description": "Secure AliExpress Affiliate API for product search, categories, and affiliate link generation. Perfect for GPT Actions integration with automatic affiliate link conversion and intelligent caching.",
    "version": "2.3.0"
  },
  "servers": [
    {
      "url": "https://aliexpress-api-proxy.vercel.app",
      "description": "Production Server"
    }
  ],
  "security": [
    {
      "InternalApiKey": []
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Basic health check endpoint to verify service is operational",
        "operationId": "healthCheck",
        "security": [],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service is unhealthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/detailed": {
      "get": {
        "summary": "Detailed Health Check",
        "description": "Comprehensive health check with component-level status including AliExpress API, cache services, and metrics",
        "operationId": "detailedHealthCheck",
        "security": [],
        "responses": {
          "200": {
            "description": "All components healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedHealthResponse"
                }
              }
            }
          },
          "207": {
            "description": "Service degraded (non-critical components unavailable)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedHealthResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service unhealthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedHealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/categories": {
      "get": {
        "summary": "Get All Categories",
        "description": "Get all parent categories from AliExpress",
        "operationId": "getCategories",
        "responses": {
          "200": {
            "description": "List of parent categories",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CategoriesResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/categories/{parent_id}/children": {
      "get": {
        "summary": "Get Child Categories",
        "description": "Get child categories for a specific parent category",
        "operationId": "getChildCategories",
        "parameters": [
          {
            "name": "parent_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The ID of the parent category"
          }
        ],
        "responses": {
          "200": {
            "description": "List of child categories",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CategoriesResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request or invalid parent_id",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/products/smart-search": {
      "post": {
        "summary": "Smart Product Search with Affiliate Links",
        "description": "ðŸš€ UNIFIED SMART SEARCH - All URLs are Final Affiliate Links. This endpoint automatically converts ALL product URLs to affiliate links using your authorized tracking ID. Features intelligent caching to reduce API calls by 70-90%. All returned URLs are ready-to-use affiliate links with full compliance.",
        "operationId": "smartProductSearch",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SmartSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Product search results with affiliate links",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SmartSearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request or invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/products/details/{product_id}": {
      "get": {
        "summary": "Get Product Details",
        "description": "Get detailed information for a single product by ID",
        "operationId": "getProductDetails",
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The product ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Product details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductDetailsResponse"
                }
              }
            }
          },
          "404": {
            "description": "Product not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/products/details": {
      "post": {
        "summary": "Get Multiple Product Details",
        "description": "Get detailed information for multiple products (up to 20)",
        "operationId": "getProductsDetailsBulk",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProductDetailsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "List of product details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductDetailsListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request or invalid product IDs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/affiliate/links": {
      "post": {
        "summary": "Generate Affiliate Links",
        "description": "Generate affiliate links for given product URLs (up to 50)",
        "operationId": "generateAffiliateLinks",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AffiliateLinksRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Generated affiliate links",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AffiliateLinksResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request or invalid URLs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/affiliate/link": {
      "get": {
        "summary": "Generate Single Affiliate Link",
        "description": "Generate affiliate link for a single product URL",
        "operationId": "generateAffiliateLinkSingle",
        "parameters": [
          {
            "name": "url",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Product URL to convert to affiliate link"
          }
        ],
        "responses": {
          "200": {
            "description": "Generated affiliate link",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AffiliateLinkResponse"
                }
              }
            }
          },
          "404": {
            "description": "Could not generate affiliate link",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/monitoring/metrics": {
      "get": {
        "summary": "Get Monitoring Metrics",
        "description": "Get comprehensive performance metrics and statistics (requires admin key)",
        "operationId": "getMonitoringMetrics",
        "security": [
          {
            "AdminApiKey": []
          }
        ],
        "responses": {
          "200": {
            "description": "System performance metrics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MonitoringMetricsResponse"
                }
              }
            }
          },
          "403": {
            "description": "Invalid or missing admin API key",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "InternalApiKey": {
        "type": "apiKey",
        "in": "header",
        "name": "x-internal-key",
        "description": "Internal API key for authentication"
      },
      "AdminApiKey": {
        "type": "apiKey",
        "in": "header",
        "name": "x-admin-key",
        "description": "Admin API key for monitoring endpoints"
      }
    },
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "enum": ["healthy", "unhealthy"]
              },
              "service_info": {
                "type": "object",
                "properties": {
                  "service_name": {
                    "type": "string"
                  },
                  "version": {
                    "type": "string"
                  },
                  "language": {
                    "type": "string"
                  },
                  "currency": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "DetailedHealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy", "degraded", "unhealthy"]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "version": {
            "type": "string"
          },
          "components": {
            "type": "object",
            "properties": {
              "aliexpress_api": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string"
                  },
                  "response_time_ms": {
                    "type": "number"
                  }
                }
              },
              "redis_cache": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string"
                  }
                }
              },
              "database_cache": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "metrics": {
            "type": "object",
            "properties": {
              "uptime": {
                "type": "string"
              },
              "total_requests": {
                "type": "integer"
              },
              "success_rate": {
                "type": "number"
              },
              "cache_hit_rate": {
                "type": "number"
              }
            }
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string"
          }
        }
      },
      "CategoriesResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Category"
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "total_count": {
                "type": "integer"
              },
              "parent_id": {
                "type": "string"
              }
            }
          }
        }
      },
      "Category": {
        "type": "object",
        "properties": {
          "category_id": {
            "type": "string"
          },
          "category_name": {
            "type": "string"
          }
        }
      },
      "SmartSearchRequest": {
        "type": "object",
        "properties": {
          "keywords": {
            "type": "string",
            "description": "Search keywords"
          },
          "category_id": {
            "type": "string",
            "description": "Category ID filter"
          },
          "max_sale_price": {
            "type": "number",
            "description": "Maximum price filter"
          },
          "min_sale_price": {
            "type": "number",
            "description": "Minimum price filter"
          },
          "page_no": {
            "type": "integer",
            "default": 1,
            "minimum": 1,
            "description": "Page number"
          },
          "page_size": {
            "type": "integer",
            "default": 20,
            "minimum": 1,
            "maximum": 50,
            "description": "Results per page"
          },
          "sort": {
            "type": "string",
            "description": "Sort order (e.g., SALE_PRICE_ASC, SALE_PRICE_DESC)"
          },
          "generate_affiliate_links": {
            "type": "boolean",
            "default": true,
            "description": "Include affiliate links in response"
          },
          "force_refresh": {
            "type": "boolean",
            "default": false,
            "description": "Force fresh API call, bypass cache"
          }
        }
      },
      "SmartSearchResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "products": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Product"
                }
              },
              "total_results": {
                "type": "integer"
              },
              "page_no": {
                "type": "integer"
              },
              "cache_hit": {
                "type": "boolean"
              }
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "search_optimization": {
                "type": "object",
                "properties": {
                  "cache_hit": {
                    "type": "boolean"
                  },
                  "api_calls_saved": {
                    "type": "integer"
                  },
                  "response_time_ms": {
                    "type": "number"
                  }
                }
              },
              "affiliate_link_info": {
                "type": "object",
                "properties": {
                  "all_urls_are_affiliate_links": {
                    "type": "boolean"
                  },
                  "tracking_id_applied": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "product_id": {
            "type": "string"
          },
          "product_title": {
            "type": "string"
          },
          "product_url": {
            "type": "string",
            "description": "Affiliate link URL (ready to use)"
          },
          "product_main_image_url": {
            "type": "string"
          },
          "sale_price": {
            "type": "number"
          },
          "original_price": {
            "type": "number"
          },
          "discount": {
            "type": "string"
          },
          "shop_name": {
            "type": "string"
          },
          "shop_url": {
            "type": "string"
          },
          "evaluate_rate": {
            "type": "string"
          }
        }
      },
      "ProductDetailsRequest": {
        "type": "object",
        "required": ["product_ids"],
        "properties": {
          "product_ids": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "maxItems": 20,
            "description": "List of product IDs (1-20)"
          }
        }
      },
      "ProductDetailsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "$ref": "#/components/schemas/ProductDetail"
          },
          "metadata": {
            "type": "object",
            "properties": {
              "product_id": {
                "type": "string"
              }
            }
          }
        }
      },
      "ProductDetailsListResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductDetail"
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "requested_count": {
                "type": "integer"
              },
              "returned_count": {
                "type": "integer"
              }
            }
          }
        }
      },
      "ProductDetail": {
        "type": "object",
        "properties": {
          "product_id": {
            "type": "string"
          },
          "product_title": {
            "type": "string"
          },
          "product_url": {
            "type": "string"
          },
          "product_main_image_url": {
            "type": "string"
          },
          "product_video_url": {
            "type": "string"
          },
          "sale_price": {
            "type": "number"
          },
          "original_price": {
            "type": "number"
          },
          "discount": {
            "type": "string"
          },
          "shop_name": {
            "type": "string"
          },
          "shop_url": {
            "type": "string"
          }
        }
      },
      "AffiliateLinksRequest": {
        "type": "object",
        "required": ["urls"],
        "properties": {
          "urls": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "maxItems": 50,
            "description": "List of product URLs to convert (1-50)"
          }
        }
      },
      "AffiliateLinksResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AffiliateLink"
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "requested_count": {
                "type": "integer"
              },
              "generated_count": {
                "type": "integer"
              },
              "tracking_id": {
                "type": "string"
              }
            }
          }
        }
      },
      "AffiliateLinkResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "$ref": "#/components/schemas/AffiliateLink"
          },
          "metadata": {
            "type": "object",
            "properties": {
              "original_url": {
                "type": "string"
              },
              "tracking_id": {
                "type": "string"
              }
            }
          }
        }
      },
      "AffiliateLink": {
        "type": "object",
        "properties": {
          "promotion_link": {
            "type": "string",
            "description": "The affiliate link with tracking ID"
          },
          "source_value": {
            "type": "string",
            "description": "Original product URL"
          }
        }
      },
      "MonitoringMetricsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "service": {
                "type": "object",
                "properties": {
                  "uptime_seconds": {
                    "type": "number"
                  },
                  "uptime_human": {
                    "type": "string"
                  }
                }
              },
              "requests": {
                "type": "object",
                "properties": {
                  "total": {
                    "type": "integer"
                  },
                  "success_rate": {
                    "type": "number"
                  },
                  "error_rate": {
                    "type": "number"
                  }
                }
              },
              "cache": {
                "type": "object",
                "properties": {
                  "hit_rate": {
                    "type": "number"
                  }
                }
              },
              "response_time": {
                "type": "object",
                "properties": {
                  "avg_ms": {
                    "type": "number"
                  },
                  "min_ms": {
                    "type": "number"
                  },
                  "max_ms": {
                    "type": "number"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
